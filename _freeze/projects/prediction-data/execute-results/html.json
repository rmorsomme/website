{
  "hash": "04d7cf1b4a66fe881aefd5405543d626",
  "result": {
    "markdown": "---\ntitle: \"Prediction Project - Data Prep\"\nsubtitle: \"STA 101L - Summer 1 2022\"\neditor: visual\neditor_options: \n  chunk_output_type: console\n---\n\nThe data can be found [here](https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/DVS/natality/Nat2020us.zip) and the help file [here](https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Dataset_Documentation/DVS/natality/UserGuide2020.pdf)\n\n## Raw Data import\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(\n  eval = FALSE\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(0)\nlibrary(tidyverse)\n\nd_sub <- read_csv(\n  \"../Nat2020us/Nat2020PublicUS.c20210506.r20210812.txt\",\n  col_names = FALSE, trim_ws = FALSE\n  ) %>%\n  slice_sample(n = 5e4)\n```\n:::\n\n## Variable extraction\n\n::: {.cell}\n\n```{.r .cell-code}\nclean_data <- function(data){\n  \n  data_clean <- data %>%\n    rename(string = X1) %>%\n    mutate(\n      month                            = str_sub(string, 13 , 14 ) %>% as.numeric,\n      mother_age                       = str_sub(string, 75 , 76 ) %>% as.numeric,\n      prenatal_care_starting_month     = str_sub(string, 224, 225) %>% as.numeric,\n      daily_cigarette_prepregnancy     = str_sub(string, 253, 254) %>% as.numeric,\n      daily_cigarette_trimester_1      = str_sub(string, 255, 256) %>% as.numeric,\n      daily_cigarette_trimester_2      = str_sub(string, 257, 258) %>% as.numeric,\n      daily_cigarette_trimester_3      = str_sub(string, 259, 260) %>% as.numeric,\n      mother_height                    = str_sub(string, 280, 281) %>% as.numeric,\n      mother_bmi                       = str_sub(string, 283, 286) %>% as.numeric,\n      mother_weight_prepregnancy       = str_sub(string, 292, 294) %>% as.numeric,\n      mother_weight_delivery           = str_sub(string, 299, 301) %>% as.numeric,\n      mother_diabetes_prepregnancy     = str_sub(string, 313, 313),\n      mother_diabetes_gestational      = str_sub(string, 314, 314),\n      mother_hypertension_prepregnancy = str_sub(string, 315, 315),\n      mother_hypertension_gestational  = str_sub(string, 316, 316),\n      mother_no_risk_factor            = str_sub(string, 337, 337) %>% as.numeric,\n      mother_gonorrhea                 = str_sub(string, 343, 343),\n      mother_syphilis                  = str_sub(string, 344, 344),\n      mother_chlamydia                 = str_sub(string, 345, 345),\n      mother_hepatitis_B               = str_sub(string, 346, 346),\n      mother_hepatitis_C               = str_sub(string, 347, 347),\n      number_newborns                  = str_sub(string, 454, 454) %>% as.numeric,\n      newborn_sex                      = str_sub(string, 475, 475),\n      gestation_week                   = str_sub(string, 490, 491) %>% as.numeric,\n      newborn_birth_weight             = str_sub(string, 504, 507) %>% as.numeric\n      ) %>%\n    filter(\n      gestation_week               <  99  ,\n      number_newborns              == 1   ,\n      mother_no_risk_factor        <= 1   ,\n      mother_weight_delivery       <  999 ,\n      mother_weight_prepregnancy   <  999 ,\n      mother_bmi                   <  99  ,\n      mother_height                <  99  ,\n      daily_cigarette_trimester_3  <  98  ,\n      daily_cigarette_trimester_2  <  98  ,\n      daily_cigarette_trimester_1  <  98  ,\n      daily_cigarette_prepregnancy <  98  ,\n      prenatal_care_starting_month <  99  ,\n      newborn_birth_weight         <  9999,\n      mother_diabetes_prepregnancy == \"N\",\n      mother_hypertension_gestational == \"N\",\n      mother_gonorrhea == \"N\",\n      mother_syphilis == \"N\",\n      mother_chlamydia == \"N\",\n      mother_hepatitis_B == \"N\",\n      mother_hepatitis_C == \"N\"\n      ) %>%\n  mutate(mother_risk_factor = !mother_no_risk_factor) %>%\n    select(\n      - string, - number_newborns,\n      - mother_diabetes_prepregnancy, - mother_hypertension_gestational, - mother_hypertension_prepregnancy, - mother_gonorrhea, - mother_syphilis, - mother_chlamydia, - mother_hepatitis_B, - mother_hepatitis_C, - mother_no_risk_factor\n      ) %>%\n    select(\n      newborn_birth_weight, everything()\n    )\n      \n  return(data_clean)\n  \n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nd_sub_clean <- clean_data(d_sub)\n\nd_train <- slice(d_sub_clean, 1     : 1e3)\nd_test  <- slice(d_sub_clean, 1e4+1 : 2e4)\n\nwrite_csv(d_train, \"projects/training_set.csv\")\n#write_csv(d_test , \"projects/test_set.csv\"    )\n```\n:::\n\n## Checking subset\n\n::: {.cell}\n\n```{.r .cell-code}\nd_num <- d_sub_clean %>% select_if(is.numeric)\nfor(i in 1 : ncol(d_num)){\n  hist(d_num[[i]], breaks = 30, xlab = names(d_num)[i], main = i)\n}\n\nd_cha <- d_sub_clean %>% select_if(is.character)\nfor(i in 1 : ncol(d_cha)){\n  print(names(d_cha)[i])\n  print(table(d_cha[[i]]))\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nm_simple <- lm(newborn_birth_weight ~ gestation_week, data = d_train)\nsummary(m_simple)\nm_full <- lm(newborn_birth_weight ~ ., data = d_train)\nsummary(m_full)\ny     <- d_test$newborn_birth_weight\nRMST <- sqrt(mean((y - mean(y))^2))\ny_hat <- predict.lm(m_full, d_test)\nsqrt(mean((y - y_hat  )^2))\ny_hat <- predict.lm(m_simple, d_test)\nsqrt(mean((y - y_hat  )^2))\n```\n:::",
    "supporting": [
      "prediction-data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": [],
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}