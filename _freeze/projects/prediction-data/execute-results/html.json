{
  "hash": "cb3470d3401872f8e2be48845524e9c7",
  "result": {
    "markdown": "---\ntitle: \"Prediction Project - Data Prep\"\nsubtitle: \"STA 101L - Summer 1 2022\"\neditor: visual\neditor_options: \n  chunk_output_type: console\n---\n\nThe data can be found [here](https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/DVS/natality/Nat2020us.zip) and the help file [here](https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Dataset_Documentation/DVS/natality/UserGuide2020.pdf)\n\n## Raw Data import\n\n::: {.cell hash='prediction-data_cache/html/unnamed-chunk-1_0dc77dd4f77fdd8423c4b596140d5585'}\n\n```{.r .cell-code}\nset.seed(0)\n\nlibrary(tidyverse)\nd_sub <- read_csv(\n  \"../Nat2020us/Nat2020PublicUS.c20210506.r20210812.txt\",\n  col_names = FALSE, trim_ws = FALSE\n  ) %>%\n  slice_sample(n = 1e5)\nwrite_csv(d_sub , \"projects/d_sub.csv\")\n```\n:::\n\n## Variable extraction\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\nclean_data <- function(data){\n  \n  data_clean <- data %>%\n    rename(string = X1) %>%\n    mutate(\n      month                            = str_sub(string, 13 , 14 ) %>% as.numeric,\n      mother_age                       = str_sub(string, 75 , 76 ) %>% as.numeric,\n      prenatal_care_starting_month     = str_sub(string, 224, 225) %>% as.numeric,\n      daily_cigarette_prepregnancy     = str_sub(string, 253, 254) %>% as.numeric,\n      daily_cigarette_trimester_1      = str_sub(string, 255, 256) %>% as.numeric,\n      daily_cigarette_trimester_2      = str_sub(string, 257, 258) %>% as.numeric,\n      daily_cigarette_trimester_3      = str_sub(string, 259, 260) %>% as.numeric,\n      mother_height                    = str_sub(string, 280, 281) %>% as.numeric,\n      mother_bmi                       = str_sub(string, 283, 286) %>% as.numeric,\n      mother_weight_prepregnancy       = str_sub(string, 292, 294) %>% as.numeric,\n      mother_weight_delivery           = str_sub(string, 299, 301) %>% as.numeric,\n      mother_diabetes_prepregnancy     = str_sub(string, 313, 313),\n      mother_diabetes_gestational      = str_sub(string, 314, 314),\n      mother_hypertension_prepregnancy = str_sub(string, 315, 315),\n      mother_hypertension_gestational  = str_sub(string, 316, 316),\n      mother_risk_factors              = str_sub(string, 337, 337) %>% as.numeric,\n      mother_gonorrhea                 = str_sub(string, 343, 343),\n      mother_syphilis                  = str_sub(string, 344, 344),\n      mother_chlamydia                 = str_sub(string, 345, 345),\n      mother_hepatitis_B               = str_sub(string, 346, 346),\n      mother_hepatitis_C               = str_sub(string, 347, 347),\n      number_newborns                  = str_sub(string, 454, 454) %>% as.numeric,\n      newborn_sex                      = str_sub(string, 475, 475),\n      gestation_week                   = str_sub(string, 490, 491) %>% as.numeric,\n      newborn_birth_weight             = str_sub(string, 504, 507) %>% as.numeric\n      ) %>%\n    filter(\n      number_newborns              == 1   ,\n      mother_risk_factors          <= 1   ,\n      mother_weight_delivery       <  999 ,\n      mother_weight_prepregnancy   <  999 ,\n      mother_bmi                   <  999 ,\n      mother_height                <  99  ,\n      daily_cigarette_trimester_3  <  98  ,\n      daily_cigarette_trimester_2  <  98  ,\n      daily_cigarette_trimester_1  <  98  ,\n      daily_cigarette_prepregnancy <  98  ,\n      prenatal_care_starting_month <  99  ,\n      prenatal_care_starting_month <  99  ,\n      newborn_birth_weight         <  9999,\n      mother_diabetes_prepregnancy == \"N\",\n      mother_hypertension_gestational == \"N\",\n      mother_gonorrhea == \"N\",\n      mother_syphilis == \"N\",\n      mother_chlamydia == \"N\",\n      mother_hepatitis_B == \"N\",\n      mother_hepatitis_C == \"N\"\n      ) %>%\n    select(\n      - string, - number_newborns,\n      - mother_diabetes_prepregnancy, - mother_hypertension_gestational, - mother_hypertension_prepregnancy, - mother_gonorrhea, - mother_syphilis, - mother_chlamydia, - mother_hepatitis_B, - mother_hepatitis_C\n      ) %>%\n    select(\n      newborn_birth_weight, everything()\n    )\n      \n  return(data_clean)\n  \n}\n\n\nd_sub_clean <- clean_data(d_sub)\n\nd_train <- slice(d_sub_clean, 1     : 1e3)\nd_test  <- slice(d_sub_clean, 1e4+1 : 2e4)\n\nwrite_csv(d_train, \"projects/training_set.csv\")\nwrite_csv(d_test , \"projects/test_set.csv\"    )\n```\n:::\n\n## Checking training set\n\n::: {.cell}\n\n```{.r .cell-code}\nd_num <- d_train %>% select_if(is.numeric)\nfor(i in 1 : ncol(d_num)){\n  hist(d_num[[i]], breaks = 30, xlab = names(d_num)[i], main = i)\n}\n\nd_cha <- d_train %>% select_if(is.character)\nfor(i in 1 : ncol(d_cha)){\n  print(names(d_cha)[i])\n  print(table(d_cha[[i]]))\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nm_simple <- lm(newborn_birth_weight ~ gestation_week, data = d_train)\nsummary(m_simple)\nm_full <- lm(newborn_birth_weight ~ ., data = d_train)\nsummary(m_full)\ny_hat <- predict.lm(m_full, d_test)\ny     <- d_test$newborn_birth_weight\nn     <- nrow(d_test)\nRMST <- sqrt(mean((y - mean(y))^2))\nRMSE <- sqrt(mean((y - y_hat  )^2))\n```\n:::\n\n# Instructions\n\n## Overview\n\nThe prediction project is released Wednesday, May 18. The prediction model is due on Tuesday, May 31, at 9:00 am. The final report is due Wednesday, June 1 at 9:00pm.\n\n🍀 Good luck! 🍀\n\n## Academic Integrity\n\nBy taking this exam, you pledge to uphold the Duke Community Standard:\n\n-   I will not lie, cheat, or steal in my academic endeavors;\n\n-   I will conduct myself honorably in all my endeavors; and\n\n-   I will act if the Standard is compromised.\n\n## Submission\n\n-   **Prediction model:** you need to submit a .RDATA file that contains your prediction model. The function takes a test set (same predictors as the training set, but no response variable) as an input and returns a prediction for each observation. The file should not contain anything else.\n\n-   **Final report:** The final report details the work you have conducted. It needs to be between 2 and 4 pages long (including code chunks, but excluding figures). The figures go in the appendix, along with any work your deem relevant, but that is notreport\n\n-   The report needs to be realized using RMarkdown and submitted on Gradescope as a PDF.\n\n# Rubric (20 points)\n\n+------------------------------------------------------------------------------------+-----------------+\n| **Part**                                                                           | **Points**      |\n+:===================================================================================+:===============:+\n| **Prediction model**                                                               | **3**           |\n|                                                                                    |                 |\n| -   .RDATA file only contains the model                                            | 1               |\n|                                                                                    |                 |\n| -   model takes a test set as input                                                | 1               |\n|                                                                                    |                 |\n| -   model returns one prediction for each observation                              | 1               |\n|                                                                                    |                 |\n| -   most accurate model                                                            | bragging rights |\n+------------------------------------------------------------------------------------+-----------------+\n| **Report**                                                                         | **16**          |\n|                                                                                    |                 |\n| -   fully reproducible analysis                                                    | 1               |\n|                                                                                    |                 |\n| -   simple model with `gestation_week` is fitted                                   | 1               |\n|                                                                                    |                 |\n| -   full model is fitted                                                           | 1               |\n|                                                                                    |                 |\n| -   at least one predictor is transformed                                          | 1               |\n|                                                                                    |                 |\n| -   variables are combined to create at least one new predictor                    | 1               |\n|                                                                                    |                 |\n| -   at least one interaction is considered                                         | 1               |\n|                                                                                    |                 |\n| -   at least a categorical predictor is considered                                 | 1               |\n|                                                                                    |                 |\n| -   subject knowledge is used to guide variable selection and feature engineering  | 2               |\n|                                                                                    |                 |\n| -   data visualization is used to guide variable selection and feature engineering | 2               |\n|                                                                                    |                 |\n| -   at least 3 models (excluding the simple and full models) are compared          | 1               |\n|                                                                                    |                 |\n|     -   using the entire sample with a suitable criterion                          | 2 (1)           |\n|                                                                                    |                 |\n|     -   using cross-validation (holdout method)                                    | 1               |\n|                                                                                    |                 |\n| -   reflection from in-class discussion                                            | 1               |\n|                                                                                    |                 |\n| -   outliers, if any, are handled appropriately                                    |                 |\n+------------------------------------------------------------------------------------+-----------------+\n| **Presentation**                                                                   | **1**           |\n|                                                                                    |                 |\n| -   ask a question in QA                                                           | 1               |\n+------------------------------------------------------------------------------------+-----------------+\n| **Total**                                                                          | 20              |\n+------------------------------------------------------------------------------------+-----------------+",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": [],
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}