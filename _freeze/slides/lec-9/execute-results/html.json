{
  "hash": "c0be29e03ea932340630ae0472472afd",
  "result": {
    "markdown": "---\ntitle: \"Logistic Regression\"\nsubtitle: \"STA 101L - Summer I 2022\"\nauthor: \"Raphael Morsomme\"\nfooter:  \"[https://rmorsomme.github.io/website/](https://rmorsomme.github.io/website/)\"\nlogo: \"images/logo.jpg\"\nformat: \n  revealjs: \n    theme: slides.scss\n    multiplex: true\n    transition: fade\n    slide-number: true\n    code-fold: false\n    code-summary: \"Show the code\"\n    scrollable: true\neditor: visual\nexecute:\n  freeze: auto\n  echo: true\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n# Welcome\n\n## Announcements\n\n-   \n\n## Recap {.smaller}\n\n## Outline\n\n-   one proportion\n-   two proportions\n-   mathematical approach\n\n# One proportion\n\n## Setup\n\n(Unknown) **population parameter**: proportion $p$\n\n**Sample statistics**: sample proportion $\\hat{p}$\n\n$H_0:p=p_0$ where $p_0$ is a number between $0$ and $1$\n\n$H_a:p\\neq p_0$\n\n## Example\n\nWhat proportion of US adults support legalizing marijuana\n\n. . .\n\nSample: 900 out of the 1500 participants in a survey say they do.\n\n. . .\n\nQuestion: What is the sample proportion $\\hat{p}$?\n\n## HT via simulation\n\n$H_0:p=0.5$\n\n$H_a:p\\neq 0.5$\n\n. . .\n\n-   Simulate many sample under $H_0$\n\n-   Determine if the observed data could have plausibly arisen under $H_0$\n\n## \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nresults <-  tibble(p_hat = numeric())\nfor(i in 1 : 1e3){\n  sim   <- rbernoulli(n = 1500, p = 0.5)        # simulate sample under H0\n  p_hat <- mean(sim)                            # compute the sample statistic p_hat\n  results <- results %>% add_row(p_hat = p_hat)\n}\nggplot(results) + geom_histogram(aes(p_hat))\n```\n\n::: {.cell-output-display}\n![](lec-9_files/figure-revealjs/unnamed-chunk-1-1.png){fig-align='center' width=80%}\n:::\n:::\n\n## Conclusion\n\nWe see that $\\hat{p}=0.6$ is clearly could not have happen under $H_0:p=0.5$.\n\nWe therefore reject the null hypothesis that $p=0.5$.\n\n. . .\n\nIf, on the other hand, the sample statistic $\\hat{p}=0.51$, then it is plausible that $p=0.5$ and we do not reject $H_0$.\n\n## p-value\n\nWhat if we do not have a clear-cut case?\n\n-   e.g., $\\hat{p}=0.525$\n\n. . .\n\n**p-value**: probability of observing a sample statistics at least as extreme as the observed one under the null hypothesis.\n\n-   the probability that $\\hat{p} > 0.525$ or $\\hat{p} < 0.475$ if $p=0.5$.\n\n## p-value in `R`\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nresults <- results %>%\n  mutate(is_more_extreme = !between(p_hat, 0.475, 0.525))\nresults\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 1,000 x 2\n   p_hat is_more_extreme\n   <dbl> <lgl>          \n 1 0.505 FALSE          \n 2 0.497 FALSE          \n 3 0.519 FALSE          \n 4 0.522 FALSE          \n 5 0.497 FALSE          \n 6 0.485 FALSE          \n 7 0.489 FALSE          \n 8 0.496 FALSE          \n 9 0.495 FALSE          \n10 0.521 FALSE          \n# ... with 990 more rows\n```\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummarize(results, p_value = mean(is_more_extreme))\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 1 x 1\n  p_value\n    <dbl>\n1   0.053\n```\n:::\n:::\n\n## p-value in practice\n\nIn practice, if a p-value is smaller than 0.05 we reject $H_0$\n\n-   less than 5% of the simulated sample were at least as extreme as the observed sample,\n\n-   it is highly unlikely that the observed sample could have arisen if $H_0$ were true.\n\n-   the results are **statistically significant**.\n\n. . .\n\n::: callout-note\n## Why 0.05\n\nTo know why 0.05 is widely used, check out this short [video](https://www.openintro.org/book/stat/why05/).\n:::\n\n# CI via bootstrap\n\nSample with repetition from the observed sample to construct many **bootstrap samples**.\n\nBootstrap samples $\\Rightarrow$ sampling distribution $\\Rightarrow$ bootstrap CI\n\n## Bootstrap\n\n![](images/lec-9/bootstrap1.png)\n\nSource: [IMS](https://www.openintro.org/book/ims/)\n\n## Bootstrap in `R`\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsample_bootstrap <- function(data){\n  n       <- nrow(data)\n  indices <- sample(1:n, size = n, replace = TRUE)\n  sample_bootstrap <- data[indices,]\n  return(sample_bootstrap)\n}\nsample_observed <- tibble(support = c(rep(1, 900), rep(0, 1500 - 900)))\nsample_observed\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 1,500 x 1\n   support\n     <dbl>\n 1       1\n 2       1\n 3       1\n 4       1\n 5       1\n 6       1\n 7       1\n 8       1\n 9       1\n10       1\n# ... with 1,490 more rows\n```\n:::\n:::\n\n::: {.cell layout-align=\"center\" hash='lec-9_cache/revealjs/unnamed-chunk-5_0ada4cee98ac29c0a8832c7d8f85be9a'}\n\n```{.r .cell-code}\nresults <- tibble(p_hat = numeric())\nset.seed(0)\nfor(i in 1 : 1e3){\n  d_boot <- sample_bootstrap(sample_observed)\n  results <- results %>% add_row(p_hat = mean(d_boot$support))\n}\nquantile(results$p_hat, c(0.05 , 0.95 )) # 90% CI\n```\n\n::: {.cell-output-stdout}\n```\n       5%       95% \n0.5813000 0.6206667 \n```\n:::\n\n```{.r .cell-code}\nquantile(results$p_hat, c(0.025, 0.975)) # 95% CI\n```\n\n::: {.cell-output-stdout}\n```\n     2.5%     97.5% \n0.5766667 0.6253500 \n```\n:::\n:::\n\n## \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(results) + geom_histogram(aes(p_hat))\n```\n\n::: {.cell-output-display}\n![](lec-9_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=80%}\n:::\n:::\n\n# Two proportions\n\n## Setup\n\nA **population** divided in two groups (group 1 and group 2)\n\n(Unknown) **population parameter**: difference in proportion $p_{diff}=p_1-p_2$\n\n**Sample statistics**: sample proportion $\\hat{p}{diff}=\\hat{p}_1-\\hat{p}_2$\n\n$H_0:\\hat{p}_{diff}=0$ (there is no difference between the two groups)\n\n$H_a:\\hat{p}_{diff}\\neq0$\n\n## Example -- sex discrimination\n\nAre individuals who identify as female discriminated against in promotion decisions made by their managers who identify as male? . . .\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Summary results for the sex discrimination study.</caption>\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"2\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">decision</div></th>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\"> sex </th>\n   <th style=\"text-align:right;\"> promoted </th>\n   <th style=\"text-align:right;\"> not promoted </th>\n   <th style=\"text-align:right;\"> Total </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;width: 7em; \"> male </td>\n   <td style=\"text-align:right;width: 7em; \"> 21 </td>\n   <td style=\"text-align:right;width: 7em; \"> 3 </td>\n   <td style=\"text-align:right;width: 7em; \"> 24 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 7em; \"> female </td>\n   <td style=\"text-align:right;width: 7em; \"> 14 </td>\n   <td style=\"text-align:right;width: 7em; \"> 10 </td>\n   <td style=\"text-align:right;width: 7em; \"> 24 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 7em; \"> Total </td>\n   <td style=\"text-align:right;width: 7em; \"> 35 </td>\n   <td style=\"text-align:right;width: 7em; \"> 13 </td>\n   <td style=\"text-align:right;width: 7em; \"> 48 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n## \n\n::: {.callout-tip icon=\"false\"}\n## Group exercise - two proportions\n\nWhat are $\\hat{p}_f$, $\\hat{p}_m$ and $\\hat{p}_{diff}$? Do you *intuitively feel* that there is the data provide convincing evidence of discrimination?\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"timer_62922f3b\" style=\"right:0;bottom:0;\" data-warnwhen=\"0\">\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">03</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n# HT via simulation\n\n$H_0:\\hat{p}_{diff}=0$\n\n$H_a:\\hat{p}_{diff}\\neq 0$\n\n. . .\n\n-   Simulate many sample under $H_0$ (assuming that there is no discrimination)\n\n-   Determine if the observed data could have plausibly arisen under $H_0$\n\n## Simulating under $H_0$\n\nUnder the null hypothesis, there is no discrimination; whether someone receives a promotion is independent of their sexual identification.\n\n. . .\n\nGoal: model the randomness that would occur if the null hypothesis was true.\n\nTo accomplish that, we can randomly re-assign the $35$ promotions among the $45$ individuals, independently of their sexual identification.\n\n## \n\n![](images/lec-9/randomization.png)\nSource: [IMS](https://www.openintro.org/book/ims/)\n\n## Simulation result\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Simulation results, where the difference in promotion rates between male and female is purely due to random chance.</caption>\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"2\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">decision</div></th>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\"> sex </th>\n   <th style=\"text-align:right;\"> promoted </th>\n   <th style=\"text-align:right;\"> not promoted </th>\n   <th style=\"text-align:right;\"> Total </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;width: 7em; \"> male </td>\n   <td style=\"text-align:right;width: 7em; \"> 18 </td>\n   <td style=\"text-align:right;width: 7em; \"> 6 </td>\n   <td style=\"text-align:right;width: 7em; \"> 24 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 7em; \"> female </td>\n   <td style=\"text-align:right;width: 7em; \"> 17 </td>\n   <td style=\"text-align:right;width: 7em; \"> 7 </td>\n   <td style=\"text-align:right;width: 7em; \"> 24 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 7em; \"> Total </td>\n   <td style=\"text-align:right;width: 7em; \"> 35 </td>\n   <td style=\"text-align:right;width: 7em; \"> 13 </td>\n   <td style=\"text-align:right;width: 7em; \"> 48 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n## Simulating under `H_0` \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nd <- gender_discrimination %>% select(gender)\npromotions_ordered <- c(rep(1, 35), rep(0, 48 - 35)) # 35 promotions and 13 non-promotions\npromotions_sim <- sample(promotions_ordered, 48) # shuffle promotions\nd_sim <- d %>% mutate(response = promotions_sim)\nd_sim\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 48 x 2\n   gender response\n   <fct>     <dbl>\n 1 male          0\n 2 male          1\n 3 male          0\n 4 male          1\n 5 male          1\n 6 male          1\n 7 male          0\n 8 male          1\n 9 male          1\n10 male          1\n# ... with 38 more rows\n```\n:::\n:::\n\n\n## Function for computing the test statistic\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncompute_p_diff <- function(data){\n  p_hat <- data %>%\n    group_by(gender) %>%\n    summarize(p_hat = mean(response))\n  p_diff_hat <- p_hat$p_hat[1] - p_hat$p_hat[2]\n  return(p_diff_hat)\n}\ncompute_p_diff(d_sim)\n```\n\n::: {.cell-output-stdout}\n```\n[1] -0.125\n```\n:::\n:::\n\n## For-loop for simulating under `H_0`\n\n::: {.cell layout-align=\"center\" hash='lec-9_cache/revealjs/unnamed-chunk-12_63204272d6cd5bae0fba4c80aa7a09e3'}\n\n```{.r .cell-code}\n# Setup\nresults <-  tibble(p_diff_hat = numeric())\nd <- gender_discrimination\npromotions <- c(rep(1, 35), rep(0, 48 - 35)) # 35 promotions and 13 non-promotions\n\n# Simulations\nset.seed(0)\nfor(i in 1 : 1e3){\n  d_sim <- d %>% mutate(response = sample(promotions, 48)) # Simulate under H0\n  results <- results %>% add_row(p_diff_hat = compute_p_diff(d_sim))  # Compute test statistic\n}\n```\n:::\n\n## Sampling distribution\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np_diff_obs <- 21 / 24 - 14 / 24\nggplot(results) + \n  geom_histogram(aes(p_diff_hat)) +\n  geom_vline(xintercept = p_diff_obs, col = \"maroon\", size = 2)\n```\n\n::: {.cell-output-display}\n![](lec-9_files/figure-revealjs/unnamed-chunk-13-1.png){fig-align='center' width=80%}\n:::\n:::\n\n## p-value\n\n\n**p-value**: the probability of observing a test statistic at least as extreme as the observed one under the null hypothesis.\n\n-   the probability that $\\hat{p}_{diff} > $ 0.2916667 or $\\hat{p} < $ -0.2916667 if there is no discrimination.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nresults %>%\n  mutate(is_more_extreme = p_diff_hat >= p_diff_obs | p_diff_hat <= -p_diff_obs) %>%\n  summarize(p_value = mean(is_more_extreme))\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 1 x 1\n  p_value\n    <dbl>\n1   0.048\n```\n:::\n:::\n\n## significance level $\\alpha = 0.05$\n\nUsing the usually significance level $\\alpha = 0.05$, we **fail to reject** the null hypothesis\n\n-   the data do not provide sufficient evidence to reject the null hypothesis,\n-   it is plausible to observe the sample collected in the study if there is no discrimination just by chance.\n\n::: callout-note\n## Statistician as messengers\nStatisticians are only messengers of the data; they only \n\n\n# CI via bootstrap\n\nSame idea as before: sample with repetition from the observed sample to construct many **bootstrap samples**.\n\nBootstrap samples $\\Rightarrow$ sampling distribution $\\Rightarrow$ bootstrap CI\n\n## Bootstrap\n\n![](images/lec-9/bootstrap2.png)\n\nSource: [IMS](https://www.openintro.org/book/ims/)\n\n## Bootstrap in `R`\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsample_observed_m <- tibble(response = c(rep(1, 21), rep(0, 24 - 21)), gender = \"male\"  )\nsample_observed_f <- tibble(response = c(rep(1, 14), rep(0, 24 - 14)), gender = \"female\")\nsample_observed_m\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 24 x 2\n   response gender\n      <dbl> <chr> \n 1        1 male  \n 2        1 male  \n 3        1 male  \n 4        1 male  \n 5        1 male  \n 6        1 male  \n 7        1 male  \n 8        1 male  \n 9        1 male  \n10        1 male  \n# ... with 14 more rows\n```\n:::\n\n```{.r .cell-code}\nsample_observed_f\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 24 x 2\n   response gender\n      <dbl> <chr> \n 1        1 female\n 2        1 female\n 3        1 female\n 4        1 female\n 5        1 female\n 6        1 female\n 7        1 female\n 8        1 female\n 9        1 female\n10        1 female\n# ... with 14 more rows\n```\n:::\n:::\n\n##\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsample_bootstrap(sample_observed_m) # bootstrap sample\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 24 x 2\n   response gender\n      <dbl> <chr> \n 1        1 male  \n 2        1 male  \n 3        0 male  \n 4        1 male  \n 5        1 male  \n 6        0 male  \n 7        1 male  \n 8        0 male  \n 9        1 male  \n10        1 male  \n# ... with 14 more rows\n```\n:::\n\n```{.r .cell-code}\nsample_bootstrap(sample_observed_f) # bootstrap sample\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 24 x 2\n   response gender\n      <dbl> <chr> \n 1        1 female\n 2        1 female\n 3        1 female\n 4        1 female\n 5        1 female\n 6        1 female\n 7        1 female\n 8        1 female\n 9        1 female\n10        1 female\n# ... with 14 more rows\n```\n:::\n:::\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nresults <- tibble(p_diff_hat = numeric())\nfor(i in 1 : 1e3){\n  d_boot_m <- sample_bootstrap(sample_observed_m)\n  d_boot_f <- sample_bootstrap(sample_observed_f)\n  \n  p_diff_hat <- compute_p_diff(rbind(d_boot_m, d_boot_f))\n  \n  results <- results %>% add_row(p_diff_hat = p_diff_hat)\n}\nquantile(results$p_diff_hat, c(0.05 , 0.95 )) # 90% CI\n```\n\n::: {.cell-output-stdout}\n```\n         5%         95% \n-0.45833333 -0.08333333 \n```\n:::\n\n```{.r .cell-code}\nquantile(results$p_diff_hat, c(0.025, 0.975)) # 95% CI\n```\n\n::: {.cell-output-stdout}\n```\n       2.5%       97.5% \n-0.50000000 -0.04166667 \n```\n:::\n:::\n\n## \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(results) + geom_histogram(aes(p_diff_hat))\n```\n\n::: {.cell-output-display}\n![](lec-9_files/figure-revealjs/unnamed-chunk-18-1.png){fig-align='center' width=80%}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"..\\site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"..\\site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n<link href=\"..\\site_libs/countdown-0.3.5/countdown.css\" rel=\"stylesheet\" />\r\n<script src=\"..\\site_libs/countdown-0.3.5/countdown.js\"></script>\r\n"
      ],
      "include-after-body": [
        "\r\n<script>\r\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\r\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\r\n  // slide changes (different for each slide format).\r\n  (function () {\r\n    function fireSlideChanged(previousSlide, currentSlide) {\r\n\r\n      // dispatch for htmlwidgets\r\n      const event = window.document.createEvent(\"Event\");\r\n      event.initEvent(\"slideenter\", true, true);\r\n      window.document.dispatchEvent(event);\r\n\r\n      // dispatch for shiny\r\n      if (window.jQuery) {\r\n        if (previousSlide) {\r\n          window.jQuery(previousSlide).trigger(\"hidden\");\r\n        }\r\n        if (currentSlide) {\r\n          window.jQuery(currentSlide).trigger(\"shown\");\r\n        }\r\n      }\r\n    }\r\n\r\n    // hookup for reveal\r\n    if (window.Reveal) {\r\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\r\n        fireSlideChanged(event.previousSlide, event.currentSlide);\r\n      });\r\n    }\r\n\r\n    // hookup for slidy\r\n    if (window.w3c_slidy) {\r\n      window.w3c_slidy.add_observer(function (slide_num) {\r\n        // slide_num starts at position 1\r\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\r\n      });\r\n    }\r\n\r\n  })();\r\n</script>\r\n\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}