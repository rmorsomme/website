{
  "hash": "4675210f828bd6ab8da0b61700dc344a",
  "result": {
    "markdown": "---\ntitle: \"Inference for proportions\"\nsubtitle: \"STA 101L - Summer I 2022\"\nauthor: \"Raphael Morsomme\"\nfooter:  \"[https://rmorsomme.github.io/website/](https://rmorsomme.github.io/website/)\"\nlogo: \"images/logo.jpg\"\nformat: \n  revealjs: \n    theme: slides.scss\n    multiplex: true\n    transition: fade\n    slide-number: true\n    code-fold: false\n    code-summary: \"Show the code\"\n    scrollable: true\neditor: visual\nexecute:\n  freeze: auto\n  echo: true\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n# Welcome\n\n## Announcements\n\n-   Data analysis in action -- [Inferring ethnicity from X-rays](https://www.boston.com/news/health/2022/05/18/scientists-create-ai-race-from-x-rays-dont-know-how-it-works-harvard-mit/)\n\n## Recap\n\n-   Statistical inference\n\n-   Five cases\n\n-   Hypothesis test\n\n-   Confidence interval\n\n-   A first glimpse of modern statistics\n\n## Outline\n\n-   One proportion\n-   Two proportions\n\n# One proportion\n\n## Setup\n\n(Unknown) **population parameter**: proportion $p$\n\n**Sample statistics**: sample proportion $\\hat{p}$\n\n. . .\n\n**Hypothesis testing**:\n\n-   $H_0:p=p_0$ where $p_0$ is a number between $0$ and $1$\n\n-   $H_a:p\\neq p_0$\n\n**Confidence interval**: range of plausible values for $p$.\n\n## Example\n\nWhat proportion of US adults support legalizing marijuana?\n\n. . .\n\nSample: 900 out of the 1500 participants in a survey say they do.\n\n. . .\n\nQuestion: What is the sample proportion $\\hat{p}$?\n\n## HT via simulation\n\n$H_0:p=0.5$\n\n$H_a:p\\neq 0.5$\n\n. . .\n\n-   Simulate many samples under $H_0$\n\n-   Determine if the observed data could have plausibly arisen under $H_0$\n\n## \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-line-numbers=\"1|2|3,7|4|5|6|\"}\nset.seed(0)\nresults <-  tibble(p_hat = numeric())\nfor(i in 1 : 1e3){\n  sim     <- rbernoulli(n = 1500, p = 0.5)      # simulate sample under H0\n  p_hat   <- mean(sim)                          # compute sample statistic p_hat\n  results <- results %>% add_row(p_hat = p_hat)\n}\nggplot(results) + geom_histogram(aes(p_hat))\n```\n\n::: {.cell-output-display}\n![](lec-9_files/figure-revealjs/unnamed-chunk-1-1.png){fig-align='center' width=80%}\n:::\n:::\n\n## Conclusion\n\nWe see that $\\hat{p}=0.6$ is extremely unlikely to happen under $H_0:p=0.5$.\n\nWe therefore reject the null hypothesis that $p=0.5$.\n\n. . .\n\nIf, on the other hand, the sample statistic had been $\\hat{p}=0.51$, then it would have been plausible that $p=0.5$, and we would not have rejected $H_0$.\n\n## p-value\n\nWhat if we do not have a clear-cut case?\n\n-   e.g., $\\hat{p}=0.52$\n\n. . .\n\n**p-value**: probability of observing a sample statistics at least as extreme as the observed one under the null hypothesis.\n\n-   the probability that $\\hat{p} > 0.52$ or $\\hat{p} < 0.48$ if $p=0.5$.\n\n## p-value in `R`\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nresults <- results %>%\n  mutate(is_more_extreme = p_hat <= 0.48 | p_hat >= 0.52)\nresults\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 1,000 x 2\n   p_hat is_more_extreme\n   <dbl> <lgl>          \n 1 0.475 TRUE           \n 2 0.485 FALSE          \n 3 0.483 FALSE          \n 4 0.528 TRUE           \n 5 0.51  FALSE          \n 6 0.493 FALSE          \n 7 0.503 FALSE          \n 8 0.5   FALSE          \n 9 0.495 FALSE          \n10 0.503 FALSE          \n# ... with 990 more rows\n```\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsummarize(results, p_value = mean(is_more_extreme))\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 1 x 1\n  p_value\n    <dbl>\n1   0.121\n```\n:::\n:::\n\n## p-value in practice\n\nIn practice, if a p-value is smaller than 0.05 we reject $H_0$\n\n-   less than 5% of the simulated samples were at least as extreme as the observed sample,\n\n-   it is highly unlikely that the observed sample could have arisen if $H_0$ were true.\n\n-   the results are **statistically significant**.\n\n. . .\n\n::: callout-note\n## Why 0.05?\n\nTo know why 0.05 is widely used in practice, check out this short [video](https://www.openintro.org/book/stat/why05/).\n:::\n\n# CI via bootstrap\n\nSample with repetition from the observed sample to construct many **bootstrap samples**.\n\nBootstrap samples $\\Rightarrow$ sampling distribution $\\Rightarrow$ bootstrap CI\n\n## Bootstrap\n\n![](images/lec-9/bootstrap1.png)\n\nSource: [IMS](https://www.openintro.org/book/ims/)\n\n## Bootstrap in `R`\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsample_bootstrap <- function(data){\n  n                <- nrow(data)\n  sample_bootstrap <- slice_sample(data, n = n, replace = TRUE)\n  return(sample_bootstrap)\n}\nsample_observed <- tibble(support = c(rep(1, 900), rep(0, 1500 - 900)))\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nset.seed(0)\nslice_sample(sample_observed, n = 5) # 5 random rows from the sample\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 5 x 1\n  support\n    <dbl>\n1       0\n2       0\n3       1\n4       1\n5       0\n```\n:::\n:::\n\n## \n\n::: {.cell layout-align=\"center\" hash='lec-9_cache/revealjs/unnamed-chunk-6_b9b10598329a1eae10f1d4e918d08058'}\n\n```{.r .cell-code}\nresults <- tibble(p_hat = numeric()) # empty data frame to collect the results\nset.seed(0)\nfor(i in 1 : 1e3){\n  d_boot  <- sample_bootstrap(sample_observed) # bootstrap sample\n  results <- results %>% \n    add_row(p_hat = mean(d_boot$support)) # sample statistic from bootstrap sample\n}\nquantile(results$p_hat, c(0.05 , 0.95 )) # 90% CI\n```\n\n::: {.cell-output-stdout}\n```\n       5%       95% \n0.5813000 0.6206667 \n```\n:::\n\n```{.r .cell-code}\nquantile(results$p_hat, c(0.025, 0.975)) # 95% CI\n```\n\n::: {.cell-output-stdout}\n```\n     2.5%     97.5% \n0.5766667 0.6253500 \n```\n:::\n:::\n\n## \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(results) + geom_histogram(aes(p_hat))\n```\n\n::: {.cell-output-display}\n![](lec-9_files/figure-revealjs/unnamed-chunk-7-1.png){fig-align='center' width=80%}\n:::\n:::\n\n# Two proportions\n\n## Setup\n\nA **population** divided in two groups (group 1 and group 2)\n\n(Unknown) **population parameter**: difference in proportion $p_{diff}=p_1-p_2$\n\n**Sample statistics**: sample proportion $\\hat{p}_{diff}=\\hat{p}_1-\\hat{p}_2$\n\n$H_0:p_{diff}=0$ (there is no difference between the two groups)\n\n$H_a:p_{diff}\\neq0$\n\n## Example -- sex discrimination\n\nAre individuals who identify as female discriminated against in promotion decisions made by their managers?\n\n. . .\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Summary results for the sex discrimination study.</caption>\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"2\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">decision</div></th>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\"> sex </th>\n   <th style=\"text-align:right;\"> promoted </th>\n   <th style=\"text-align:right;\"> not promoted </th>\n   <th style=\"text-align:right;\"> Total </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;width: 7em; \"> male </td>\n   <td style=\"text-align:right;width: 7em; \"> 21 </td>\n   <td style=\"text-align:right;width: 7em; \"> 3 </td>\n   <td style=\"text-align:right;width: 7em; \"> 24 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 7em; \"> female </td>\n   <td style=\"text-align:right;width: 7em; \"> 14 </td>\n   <td style=\"text-align:right;width: 7em; \"> 10 </td>\n   <td style=\"text-align:right;width: 7em; \"> 24 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 7em; \"> Total </td>\n   <td style=\"text-align:right;width: 7em; \"> 35 </td>\n   <td style=\"text-align:right;width: 7em; \"> 13 </td>\n   <td style=\"text-align:right;width: 7em; \"> 48 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n## \n\n::: {.callout-tip icon=\"false\"}\n## Group exercise - two proportions\n\nWhat are $\\hat{p}_f$, $\\hat{p}_m$ and $\\hat{p}_{diff}$? Do you *intuitively feel* that the data provide convincing evidence of sex discrimination?\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"timer_6297fb7b\" style=\"right:0;bottom:0;\" data-warnwhen=\"0\">\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">03</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n# HT via simulation\n\n$H_0:\\hat{p}_{diff}=0$\n\n$H_a:\\hat{p}_{diff}\\neq 0$\n\n. . .\n\n-   Simulate many samples under $H_0$ (assuming that there is no discrimination)\n\n-   Determine if the observed data could have plausibly arisen under $H_0$\n\n## Simulating under $H_0$\n\nUnder the null hypothesis, there is no discrimination -- whether someone receives a promotion is independent of their sexual identification.\n\n. . .\n\nGoal: model the randomness that would occur if the null hypothesis was true.\n\nTo accomplish that, we can randomly re-assign the $35$ promotions among the $45$ individuals, independently of their sexual identification.\n\n## \n\n![](images/lec-9/randomization.png) Source: [IMS](https://www.openintro.org/book/ims/)\n\n## Simulation result\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"2\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">decision</div></th>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\"> sex </th>\n   <th style=\"text-align:right;\"> promoted </th>\n   <th style=\"text-align:right;\"> not promoted </th>\n   <th style=\"text-align:right;\"> Total </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;width: 7em; \"> male </td>\n   <td style=\"text-align:right;width: 7em; \"> 18 </td>\n   <td style=\"text-align:right;width: 7em; \"> 6 </td>\n   <td style=\"text-align:right;width: 7em; \"> 24 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 7em; \"> female </td>\n   <td style=\"text-align:right;width: 7em; \"> 17 </td>\n   <td style=\"text-align:right;width: 7em; \"> 7 </td>\n   <td style=\"text-align:right;width: 7em; \"> 24 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 7em; \"> Total </td>\n   <td style=\"text-align:right;width: 7em; \"> 35 </td>\n   <td style=\"text-align:right;width: 7em; \"> 13 </td>\n   <td style=\"text-align:right;width: 7em; \"> 48 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n## Simulating under $H_0$\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-line-numbers=\"2|3|4|\"}\nd <- gender_discrimination %>% select(gender)\npromotions_ordered <- c(rep(1, 35), rep(0, 48 - 35)) # 35 promotions and 13 non-promotions\npromotions_sim <- sample(promotions_ordered, 48) # shuffle promotions\nd_sim <- d %>% mutate(response = promotions_sim)\nd_sim\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 48 x 2\n   gender response\n   <fct>     <dbl>\n 1 male          0\n 2 male          1\n 3 male          0\n 4 male          1\n 5 male          1\n 6 male          1\n 7 male          0\n 8 male          1\n 9 male          1\n10 male          1\n# ... with 38 more rows\n```\n:::\n:::\n\n## Function for computing the test statistic\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncompute_p_diff <- function(data){\n  p_hat <- data %>%\n    group_by(gender) %>%\n    summarize(p_hat = mean(response))\n  p_diff_hat <- p_hat$p_hat[1] - p_hat$p_hat[2]\n  return(p_diff_hat)\n}\ncompute_p_diff(d_sim)\n```\n\n::: {.cell-output-stdout}\n```\n[1] -0.125\n```\n:::\n:::\n\n## For-loop for simulating under $H_0$\n\n::: {.cell layout-align=\"center\" hash='lec-9_cache/revealjs/unnamed-chunk-13_0fa689e02a937437b0b3c25fce6c3d0f'}\n\n```{.r .cell-code}\n# Setup\nresults    <-  tibble(p_diff_hat = numeric())\nd          <- gender_discrimination\npromotions <- c(rep(1, 35), rep(0, 48 - 35))\n\n# Simulations\nset.seed(0)\nfor(i in 1 : 1e3){\n  d_sim <- d %>% mutate(response = sample(promotions, 48)) # simulate under H0\n  results <- results %>% add_row(p_diff_hat = compute_p_diff(d_sim))  # test statistic\n}\n```\n:::\n\n## Sampling distribution\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np_diff_obs <- 21 / 24 - 14 / 24\nggplot(results) + \n  geom_histogram(aes(p_diff_hat)) +\n  geom_vline(xintercept = p_diff_obs, col = \"maroon\", size = 2)\n```\n\n::: {.cell-output-display}\n![](lec-9_files/figure-revealjs/unnamed-chunk-14-1.png){fig-align='center' width=80%}\n:::\n:::\n\n## p-value\n\n**p-value**: the probability of observing a test statistic at least as extreme as the observed one under the null hypothesis.\n\n-   the probability that $\\hat{p}_{diff}>$ 0.29 or $\\hat{p}<$ -0.29 if there is no discrimination.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nresults %>%\n  mutate(is_more_extreme = p_diff_hat >= p_diff_obs | p_diff_hat <= -p_diff_obs) %>%\n  summarize(p_value = mean(is_more_extreme))\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 1 x 1\n  p_value\n    <dbl>\n1   0.048\n```\n:::\n:::\n\n## significance level $\\alpha = 0.05$\n\nUsing the usually significance level $\\alpha = 0.05$, we **fail to reject** the null hypothesis\n\n-   the data do not provide sufficient evidence to reject the null hypothesis,\n-   it is plausible to observe the sample collected in the study if there is no discrimination just by chance.\n\n::: callout-note\n## Statisticians as messengers\n\nStatisticians are only messengers of the data; they only interpret what the data are indicating.\n:::\n\n# CI via bootstrap\n\nSame idea as before: sample with repetition from the observed data to construct many **bootstrap samples**.\n\nBootstrap samples $\\Rightarrow$ sampling distribution $\\Rightarrow$ bootstrap CI\n\n## Bootstrap\n\n![](images/lec-9/bootstrap2.png)\n\nSource: [IMS](https://www.openintro.org/book/ims/)\n\n## Bootstrap in `R`\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsample_observed_m <- tibble(response = c(rep(1, 21), rep(0, 3 )), gender = \"male\"  )\nsample_observed_f <- tibble(response = c(rep(1, 14), rep(0, 10)), gender = \"female\")\nset.seed(0)\nsample_bootstrap(sample_observed_m) # bootstrap sample\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 24 x 2\n   response gender\n      <dbl> <chr> \n 1        1 male  \n 2        1 male  \n 3        1 male  \n 4        1 male  \n 5        1 male  \n 6        0 male  \n 7        1 male  \n 8        1 male  \n 9        1 male  \n10        1 male  \n# ... with 14 more rows\n```\n:::\n\n```{.r .cell-code}\nsample_bootstrap(sample_observed_f) # bootstrap sample\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 24 x 2\n   response gender\n      <dbl> <chr> \n 1        1 female\n 2        1 female\n 3        1 female\n 4        1 female\n 5        1 female\n 6        0 female\n 7        1 female\n 8        0 female\n 9        1 female\n10        1 female\n# ... with 14 more rows\n```\n:::\n:::\n\n## \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-line-numbers=\"3,4|5|6|\"}\nresults <- tibble(p_diff_hat = numeric())\nfor(i in 1 : 1e3){\n  d_boot_m   <- sample_bootstrap(sample_observed_m) # bootstrap sample\n  d_boot_f   <- sample_bootstrap(sample_observed_f) # bootstrap sample\n  p_diff_hat <- compute_p_diff(rbind(d_boot_m, d_boot_f))\n  results    <- results %>% add_row(p_diff_hat = p_diff_hat)\n}\nquantile(results$p_diff_hat, c(0.05 , 0.95 )) # 90% CI\n```\n\n::: {.cell-output-stdout}\n```\n         5%         95% \n-0.50000000 -0.08333333 \n```\n:::\n\n```{.r .cell-code  code-line-numbers=\"3,4|5|6|\"}\nquantile(results$p_diff_hat, c(0.05 , 0.95 )) %>% signif(2) # 90% CI\n```\n\n::: {.cell-output-stdout}\n```\n    5%    95% \n-0.500 -0.083 \n```\n:::\n\n```{.r .cell-code  code-line-numbers=\"3,4|5|6|\"}\nquantile(results$p_diff_hat, c(0.025, 0.975)) %>% signif(2) # 95% CI\n```\n\n::: {.cell-output-stdout}\n```\n  2.5%  97.5% \n-0.540 -0.042 \n```\n:::\n:::\n\n## \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(results) + geom_histogram(aes(p_diff_hat))\n```\n\n::: {.cell-output-display}\n![](lec-9_files/figure-revealjs/unnamed-chunk-18-1.png){fig-align='center' width=80%}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"..\\site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"..\\site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n<link href=\"..\\site_libs/countdown-0.3.5/countdown.css\" rel=\"stylesheet\" />\r\n<script src=\"..\\site_libs/countdown-0.3.5/countdown.js\"></script>\r\n"
      ],
      "include-after-body": [
        "\r\n<script>\r\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\r\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\r\n  // slide changes (different for each slide format).\r\n  (function () {\r\n    function fireSlideChanged(previousSlide, currentSlide) {\r\n\r\n      // dispatch for htmlwidgets\r\n      const event = window.document.createEvent(\"Event\");\r\n      event.initEvent(\"slideenter\", true, true);\r\n      window.document.dispatchEvent(event);\r\n\r\n      // dispatch for shiny\r\n      if (window.jQuery) {\r\n        if (previousSlide) {\r\n          window.jQuery(previousSlide).trigger(\"hidden\");\r\n        }\r\n        if (currentSlide) {\r\n          window.jQuery(currentSlide).trigger(\"shown\");\r\n        }\r\n      }\r\n    }\r\n\r\n    // hookup for reveal\r\n    if (window.Reveal) {\r\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\r\n        fireSlideChanged(event.previousSlide, event.currentSlide);\r\n      });\r\n    }\r\n\r\n    // hookup for slidy\r\n    if (window.w3c_slidy) {\r\n      window.w3c_slidy.add_observer(function (slide_num) {\r\n        // slide_num starts at position 1\r\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\r\n      });\r\n    }\r\n\r\n  })();\r\n</script>\r\n\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}