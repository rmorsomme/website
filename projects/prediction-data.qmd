---
title: "Prediction Project - Data Prep"
subtitle: "STA 101L - Summer 1 2022"
editor: visual
editor_options: 
  chunk_output_type: console
---

The data can be found [here](https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/DVS/natality/Nat2020us.zip) and the help file [here](https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Dataset_Documentation/DVS/natality/UserGuide2020.pdf)

## Raw Data import

```{r, eval=FALSE, cache=TRUE}
library(tidyverse)
d <- read_csv(
  "../Nat2020us/Nat2020PublicUS.c20210506.r20210812.txt",
  col_names = FALSE, trim_ws = FALSE
  ) %>%
  slice(1:10)
```

## Variable extraction

```{r, eval=FALSE}
d_clean <- d %>%
  rename(string = X1) %>%
  mutate(
    year                             = str_sub(string, 9  , 12 ),
    month                            = str_sub(string, 13 , 14 ),
    mother_age                       = str_sub(string, 75 , 76 ),
    prenatal_car_starting_month      = str_sub(string, 224, 225),
    daily_cigarette_prepregnancy     = str_sub(string, 253, 254),
    daily_cigarette_trimester_1      = str_sub(string, 255, 256),
    daily_cigarette_trimester_2      = str_sub(string, 257, 258),
    daily_cigarette_trimester_3      = str_sub(string, 259, 260),
    mother_height                    = str_sub(string, 280, 281),
    mother_bmi                       = str_sub(string, 283, 286),
    mother_weight_prepregnancy       = str_sub(string, 292, 294),
    mother_weight_delivery           = str_sub(string, 299, 301),
    mother_diabetes_prepregnancy     = str_sub(string, 313, 313),
    mother_diabetes_gestational      = str_sub(string, 314, 314),
    mother_hypertension_prepregnancy = str_sub(string, 315, 315),
    mother_hypertension_gestational  = str_sub(string, 316, 316),
    risk_factors                     = str_sub(string, 337, 337),
    gonorrhea                        = str_sub(string, 343, 343),
    syphilis                         = str_sub(string, 344, 344),
    chlamydia                        = str_sub(string, 345, 345),
    hepatitis_B                      = str_sub(string, 346, 346),
    hepatitis_C                      = str_sub(string, 347, 347),
    number_newborns                  = str_sub(string, 454, 454),
    newborn_sex                      = str_sub(string, 475, 475),
    gestation_week                   = str_sub(string, 490, 491),
    newborn_birth_weight             = str_sub(string, 504, 507)
    ) %>%
  select(newborn_birth_weight, !matches("string"), string)
```

# Instructions

## Overview

The prediction project is released Wednesday, May 18. The prediction model is due on Tuesday, May 31, at 9:00 am. The final report is due Wednesday, June 1 at 9:00pm.

üçÄ Good luck! üçÄ

## Academic Integrity

By taking this exam, you pledge to uphold the Duke Community Standard:

-   I will not lie, cheat, or steal in my academic endeavors;

-   I will conduct myself honorably in all my endeavors; and

-   I will act if the Standard is compromised.

## Submission

-   **Prediction model:** you need to submit a .RDATA file that contains your prediction model. The function takes a test set (same predictors as the training set, but no response variable) as an input and returns a prediction for each observation. The file should not contain anything else.

-   **Final report:** The final report details the work you have conducted. It needs to be between 2 and 4 pages long (including code chunks, but excluding figures). The figures go in the appendix, along with any work your deem relevant, but that is notreport

-   The report needs to be realized using RMardown and submitted on Gradescope as a PDF.

# Grading (50 pts)

+-----------------------------------------------------------------------------------+-----------------+
| **Part**                                                                          | **Points**      |
+:==================================================================================+:===============:+
| **Prediction model**                                                              | **3**           |
|                                                                                   |                 |
| -   .RDATA file only contains the model                                           | 1               |
|                                                                                   |                 |
| -   model takes a test set as input                                               | 1               |
|                                                                                   |                 |
| -   model returns one prediction for each observation                             | 1               |
|                                                                                   |                 |
| -   most accurate model                                                           | bragging rights |
+-----------------------------------------------------------------------------------+-----------------+
| **Report**                                                                        | **11**          |
|                                                                                   |                 |
| -   reproducible                                                                  | 1               |
|                                                                                   |                 |
| -   simple model is fitted                                                        | 1               |
|                                                                                   |                 |
| -   full model is fitted                                                          | 1               |
|                                                                                   |                 |
| -   at least a predictor is transformed                                           | 1               |
|                                                                                   |                 |
| -   predictors are combined to create at least a new one                          | 1               |
|                                                                                   |                 |
| -   at least one interaction is considerd                                         | 1               |
|                                                                                   |                 |
| -   at least a categorical predictor                                              | 1               |
|                                                                                   |                 |
| -   subject knowledge is used to guide variable selection and feature engineering | 1               |
|                                                                                   |                 |
| -   models are compared using                                                     | 1               |
|                                                                                   |                 |
|     -   a suitable criterion                                                      | 2 (1)           |
|                                                                                   |                 |
|     -   cross-validation (holdout method)                                         |                 |
+-----------------------------------------------------------------------------------+-----------------+
| **Participation**                                                                 | **1**           |
|                                                                                   |                 |
| -   ask a question in QA                                                          | 1               |
+-----------------------------------------------------------------------------------+-----------------+
| **Total**                                                                         | 20              |
+-----------------------------------------------------------------------------------+-----------------+
